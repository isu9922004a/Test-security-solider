<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è»äº‹æº–å‰‡æ¸¬é©— v1.1 (ä¸»é¸å–®ç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #c0392b;
            --success: #27ae60;
            --highlight: #f39c12;
            --bg: #fdfbf7;
            --text: #2c3e50;
            --menu-btn-bg: #fff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 650px;
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            position: relative;
            /* é è¨­éš±è—æ‰€æœ‰å€å¡Šï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            display: none; 
        }

        /* é€šç”¨é¡¯ç¤ºæ§åˆ¶ */
        .active-view { display: block !important; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ä¸»é¸å–® (Menu) æ¨£å¼ --- */
        .menu-title {
            text-align: center;
            color: var(--primary);
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 5px;
            border-bottom: 3px solid var(--highlight);
            display: inline-block;
            padding-bottom: 5px;
        }

        .menu-subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 30px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .menu-btn {
            background: var(--menu-btn-bg);
            border: 2px solid #eee;
            padding: 20px;
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .menu-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .btn-icon { font-size: 1.5rem; margin-right: 15px; }
        .btn-text { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .btn-count { font-size: 0.85rem; color: #95a5a6; background: #f8f9fa; padding: 2px 8px; border-radius: 10px; }

        /* --- æ¸¬é©—ä»‹é¢æ¨£å¼ --- */
        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .home-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: 0.2s;
        }
        .home-btn:hover { background: #eee; }

        .badge-group { display: flex; gap: 10px; align-items: center; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; }
        .badge-progress { background: #ecf0f1; color: #7f8c8d; }
        .badge-score { background: var(--highlight); color: white; }

        .cat-tag {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .q-content { font-size: 1.35rem; font-weight: 800; color: var(--primary); line-height: 1.4; margin-bottom: 15px; }

        textarea {
            width: 100%;
            height: 110px;
            padding: 15px;
            font-size: 1.25rem;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            resize: none;
            box-sizing: border-box;
            outline: none;
            background: #fafafa;
            transition: all 0.2s;
            color: #333;
        }
        
        textarea:focus { border-color: var(--primary); background: white; }
        textarea.correct-state { border-color: var(--success); background: #f0fdf4; color: #166534; }
        textarea.wrong-state { border-color: var(--accent); background: #fef2f2; color: #991b1b; }

        /* å›é¥‹å€ */
        .feedback-area { display: none; margin-top: 20px; animation: slideUp 0.3s ease-out; }
        .comparison-box { background: #f8fafc; border-radius: 10px; padding: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .row { display: flex; flex-direction: column; margin-bottom: 10px; }
        .label { font-size: 0.8rem; color: #64748b; font-weight: bold; }
        .text-val { font-size: 1.1rem; font-weight: bold; line-height: 1.5; }
        .val-wrong { color: var(--accent); text-decoration: line-through; text-decoration-color: rgba(192, 57, 43, 0.4); }
        .val-correct { color: var(--success); }

        .mnemonic-card { background: #fffbeb; border: 2px dashed #fcd34d; border-radius: 10px; padding: 15px; }
        .mnemonic-title { color: #d97706; font-weight: bold; font-size: 0.9rem; margin-bottom: 5px; }
        .highlight { color: #d35400; font-weight: 800; background: rgba(243, 156, 18, 0.15); padding: 0 2px; }

        /* æŒ‰éˆ•ç¾¤ */
        .controls { display: flex; gap: 12px; margin-top: 25px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 10px; font-size: 1rem; font-weight: bold; cursor: pointer; color: white; display: flex; justify-content: center; align-items: center; }
        .btn:active { transform: scale(0.98); }
        .btn-check { background-color: var(--primary); }
        .btn-back { background-color: #95a5a6; flex: 0.3; }
        .btn-next { background-color: var(--success); display: none; }
        .btn-menu { background-color: var(--primary); width: 100%; margin-top: 10px; }

        /* çµæœç•«é¢ */
        .result-view { text-align: center; }
        .final-score { font-size: 5rem; font-weight: 900; color: var(--primary); line-height: 1; margin: 20px 0; }
        .result-comment { font-size: 1.3rem; color: #555; margin-bottom: 30px; }

        @media (min-width: 600px) {
            .menu-grid { grid-template-columns: 1fr 1fr; }
            .menu-btn-full { grid-column: span 2; }
        }

    </style>
</head>
<body>

    <!-- 1. ä¸»é¸å–® (Menu Interface) -->
    <div class="container active-view" id="menu-interface">
        <div style="text-align: center;">
            <div class="menu-title">ğŸ›¡ï¸ æˆ°æƒ…ä¸­å¿ƒ</div>
            <div class="menu-subtitle">è«‹é¸æ“‡é‘‘æ¸¬ç§‘ç›®</div>
        </div>

        <div class="menu-grid">
            <div class="menu-btn" onclick="startQuiz('sentry')">
                <div style="display:flex; align-items:center;">
                    <span class="btn-icon">ğŸ‘®</span>
                    <span class="btn-text">è¡›å“¨å®ˆå‰‡</span>
                </div>
                <span class="btn-count">8é¡Œ</span>
            </div>

            <div class="menu-btn" onclick="startQuiz('safety')">
                <div style="display:flex; align-items:center;">
                    <span class="btn-icon">ğŸš¨</span>
                    <span class="btn-text">å®‰å®˜å®ˆå‰‡</span>
                </div>
                <span class="btn-count">8é¡Œ</span>
            </div>

            <div class="menu-btn" onclick="startQuiz('timing')">
                <div style="display:flex; align-items:center;">
                    <span class="btn-icon">ğŸ§Ÿ</span>
                    <span class="btn-text">ç”¨æ§æ™‚æ©Ÿ</span>
                </div>
                <span class="btn-count">5é¡Œ</span>
            </div>

            <div class="menu-btn" onclick="startQuiz('guide')">
                <div style="display:flex; align-items:center;">
                    <span class="btn-icon">ğŸ”«</span>
                    <span class="btn-text">ç”¨æ§è¦é ˜</span>
                </div>
                <span class="btn-count">5é¡Œ</span>
            </div>

            <div class="menu-btn menu-btn-full" onclick="startQuiz('all')" style="background:#fdf2e9; border-color:#f39c12;">
                <div style="display:flex; align-items:center;">
                    <span class="btn-icon">ğŸ”¥</span>
                    <span class="btn-text">ç¶œåˆå¤§äº‚é¬¥ (éš¨æ©Ÿ10é¡Œ)</span>
                </div>
                <span class="btn-count">High</span>
            </div>
        </div>
    </div>

    <!-- 2. æ¸¬é©—ä»‹é¢ (Quiz Interface) -->
    <div class="container" id="quiz-interface">
        <div class="header-info">
            <button class="home-btn" onclick="confirmExit()" title="å›ä¸»é¸å–®">ğŸ </button>
            <div class="badge-group">
                <span class="badge badge-progress" id="progress-disp">1 / 10</span>
                <span class="badge badge-score" id="score-disp">å¾—åˆ†: 0</span>
            </div>
        </div>

        <div class="q-section">
            <span class="cat-tag" id="q-category">è¡›å“¨å®ˆå‰‡</span>
            <div class="q-content" id="q-text">ç¬¬ 1 æ¢</div>
        </div>

        <textarea id="user-input" placeholder="è«‹è¼¸å…¥æ¢æ–‡..." spellcheck="false" autocomplete="off"></textarea>

        <!-- å›é¥‹å€ -->
        <div class="feedback-area" id="feedback-ui">
            <div class="comparison-box" id="comparison-box">
                <div class="row" id="user-row">
                    <span class="label">âŒ æ‚¨çš„ç­”æ¡ˆï¼š</span>
                    <span class="text-val val-wrong" id="user-ans-text"></span>
                </div>
                <div class="row">
                    <span class="label">âœ… æ­£ç¢ºæ¢æ–‡ï¼š</span>
                    <span class="text-val val-correct" id="correct-ans-text"></span>
                </div>
            </div>

            <div class="mnemonic-card">
                <div class="mnemonic-title">ğŸ’¡ è…¦å…§è«§éŸ³å£è¨£</div>
                <div class="mnemonic-content" id="hint-text"></div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-back" id="btn-back" onclick="goBack()" disabled>â¬…</button>
            <button class="btn btn-check" id="btn-action" onclick="submitCheck()">é€å‡ºæª¢æŸ¥ (Enter)</button>
        </div>
    </div>

    <!-- 3. çµç®—ç•«é¢ (Result Interface) -->
    <div class="container result-view" id="result-interface">
        <h2 style="color:var(--primary); margin-bottom:0;">é‘‘æ¸¬æˆç¸¾å–®</h2>
        <div style="font-size:0.9rem; color:#999; margin-bottom:10px;">æœ¬æ¬¡æ¸¬é©—çµæŸ</div>
        <div class="final-score" id="final-score-val">0</div>
        <div class="result-comment" id="final-comment"></div>
        
        <button class="btn btn-check" onclick="restartCurrentQuiz()" style="margin-bottom: 10px;">å†æ¸¬ä¸€æ¬¡ (åŒç§‘ç›®)</button>
        <button class="btn btn-menu" onclick="showMenu()">å›ä¸»é¸å–® (é¸å…¶ä»–)</button>
    </div>

    <script>
        // è³‡æ–™åº«ï¼šå«æ¨™é»ç¬¦è™Ÿæ­£ç¢ºç‰ˆ
        const database = [
            // è¡›å“¨å®ˆå‰‡ (type: sentry)
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 1, q: "ç¬¬ 1 æ¢", a: "æœè£æ•´é½Šã€é…ä»¶å…‰äº®ã€‚", h: "é‹¼éµäºº<span class='highlight'>æœè£</span>æ˜¯é‘½çŸ³ï¼Œ<span class='highlight'>é…ä»¶</span>æ˜¯é¡å­ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 2, q: "ç¬¬ 2 æ¢", a: "ç²¾ç¥é£½æ»¿ã€å§¿æ…‹ç«¯æ­£ã€‚", h: "å–è »ç‰›<span class='highlight'>ç²¾ç¥</span>å¥½ï¼ŒèƒŒæ’é‹¼æ¿<span class='highlight'>å§¿æ…‹</span>æ­£ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 3, q: "ç¬¬ 3 æ¢", a: "æ¢°å½ˆæ”œå¸¶ã€ç¢ºéµè¦å®šã€‚", h: "<span class='highlight'>æ¢°å½ˆ</span>å¸¶ä¸å¥½å°±å®Œè›‹ï¼Œè«‹æŠŠè›‹è›‹ç¶åœ¨æ§ä¸Šã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 4, q: "ç¬¬ 4 æ¢", a: "å …å®ˆå´—ä½ã€åš´å¯†æœæŸ¥ã€‚", h: "è…³è¸©ä¸‰ç§’è† <span class='highlight'>å …å®ˆ</span>ï¼Œæ‹¿æ”¾å¤§é¡<span class='highlight'>æœæŸ¥</span>èèŸ»ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 5, q: "ç¬¬ 5 æ¢", a: "æé«˜è­¦è¦ºã€æ™‚æ™‚æˆ’å‚™ã€‚", h: "é ­è£é›·é”<span class='highlight'>è­¦è¦º</span>ï¼Œæ‰‹æ‹¿é›»æ“Šæ£’<span class='highlight'>æˆ’å‚™</span>ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 6, q: "ç¬¬ 6 æ¢", a: "ä¸çœ‹ç†±é¬§ã€æ³¨æ„å¯ç–‘ã€‚", h: "è¾£å¦¹è·³èˆ<span class='highlight'>ä¸çœ‹</span>(ç†±é¬§)ï¼Œåªç›¯è‘—<span class='highlight'>å¯ç–‘</span>é˜¿ä¼¯ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 7, q: "ç¬¬ 7 æ¢", a: "æœå‹¤èªçœŸã€èªªè©±å®¢æ°£ã€‚", h: "æ®ºæ°£é¨°é¨°ä½†å°äºº<span class='highlight'>å®¢æ°£</span>ï¼Œåƒç©ºå§ä¸€æ¨£ã€‚" },
            { type: "sentry", cat: "è¡›å“¨å®ˆå‰‡", id: 8, q: "ç¬¬ 8 æ¢", a: "åš´æ ¼ç®¡åˆ¶ã€ä»”ç´°æŸ¥é©—ã€‚", h: "æ”¾ä¸‹éµé–€<span class='highlight'>ç®¡åˆ¶</span>ï¼Œç”¨é¡¯å¾®é¡<span class='highlight'>æŸ¥é©—</span>ç´°èŒã€‚" },

            // å®‰å®˜å®ˆå‰‡ (type: safety)
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 1, q: "ç¬¬ 1 æ¢", a: "è² è²¬å–®ä½å®‰å…¨ã€‚", h: "æŠ±è‘—å·¨å¤§çš„<span class='highlight'>ä¿éšªç®±</span>(å–®ä½å®‰å…¨)ä¸æ”¾ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 2, q: "ç¬¬ 2 æ¢", a: "æ¢°å½ˆæ¸…é»ç®¡åˆ¶ã€‚", h: "åƒæ•¸éˆ”ç¥¨ä¸€æ¨£<span class='highlight'>æ•¸å­å½ˆ</span>ï¼Œå°‘ä¸€é¡†å°±åˆ‡è›‹ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 3, q: "ç¬¬ 3 æ¢", a: "åš´å¯†æ°´é›»ç®¡åˆ¶ã€‚", h: "å·¦æ‰‹é—œçš®å¡ä¸˜(é›»)ï¼Œå³æ‰‹é—œå‚‘å°¼é¾œ(æ°´)ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 4, q: "ç¬¬ 4 æ¢", a: "æ¸…æŸ¥å°±å¯¢äººæ•¸ã€‚", h: "æ‹¿ç‰§ç¾Šæ–å»å¯¢å®¤<span class='highlight'>æ•¸ç¾Š</span>(å°±å¯¢äººæ•¸)ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 5, q: "ç¬¬ 5 æ¢", a: "å·¡è¦–è¡›å“¨å‹¤å‹™ã€‚", h: "æ‹¿æœ›é é¡å·çœ‹é–€å£<span class='highlight'>è¡›å“¨</span>æœ‰æ²’æœ‰å·ç¡è¦ºã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 6, q: "ç¬¬ 6 æ¢", a: "æ³¨æ„å¯ç–‘äººç‰©ã€‚", h: "æ¡Œåº•é‘½å‡ºä¸€å€‹<span class='highlight'>å¿è€…</span>(å¯ç–‘äººç‰©)ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 7, q: "ç¬¬ 7 æ¢", a: "æ¥è½æˆ°æƒ…é›»è©±ã€‚", h: "é›»è©±éŸ¿åƒç©ºè¥²è­¦å ±ï¼Œåš‡åˆ°ç«™èµ·ä¾†æ¥<span class='highlight'>æˆ°æƒ…</span>ã€‚" },
            { type: "safety", cat: "å®‰å®˜å®ˆå‰‡", id: 8, q: "ç¬¬ 8 æ¢", a: "åæ˜ ç·Šæ€¥äº‹æ•…ã€‚", h: "å¤±ç«äº†ï¼å¿«æŒ‰æ¡Œä¸Šç´…è‰²çš„<span class='highlight'>SOSæŒ‰éˆ•</span>ã€‚" },

            // ç”¨æ§æ™‚æ©Ÿ (type: timing)
            { type: "timing", cat: "ç”¨æ§æ™‚æ©Ÿ", id: 1, q: "ç”Ÿå‘½èº«é«”å—æš´è¡Œè„…è¿«æ™‚...", a: "ç”Ÿå‘½èº«é«”å—æš´è¡Œè„…è¿«ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½æŠµæŠ—æˆ–è‡ªè¡›æ™‚ã€‚", h: "å£è¨£ï¼š<span class='highlight'>æ®­å±å‹’è„–</span>ï¼ä¸é–‹æ§æœƒæ­»ã€‚" },
            { type: "timing", cat: "ç”¨æ§æ™‚æ©Ÿ", id: 2, q: "ç¾¤çœ¾æš´å‹•æ™‚...", a: "ç¾¤çœ¾æš´å‹•ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½åˆ¶æ­¢æ™‚ã€‚", h: "å£è¨£ï¼š<span class='highlight'>æš´æ°‘æ¨ç‰†</span>ï¼ä¸€è¬äººè¡éä¾†ã€‚" },
            { type: "timing", cat: "ç”¨æ§æ™‚æ©Ÿ", id: 3, q: "æ‰€è­¦è¡›ä¹‹äººå“¡ç‰©è³‡å—å±å®³æ™‚...", a: "æ‰€è­¦è¡›ä¹‹äººå“¡ã€ç‰©è³‡ã€è»Šèˆ¹ã€èˆªç©ºå™¨å—å±å®³è„…è¿«æ™‚ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½ä¿è­·æ™‚ã€‚", h: "å£è¨£ï¼š<span class='highlight'>å°å·æ¶é£›æ©Ÿ</span>ï¼ä¿è­·ä½ çš„è»Šèˆ¹èˆªç©ºå™¨ã€‚" },
            { type: "timing", cat: "ç”¨æ§æ™‚æ©Ÿ", id: 4, q: "é˜²è¡›é§æ‰€å—è¥²æ“¾æ™‚...", a: "å› é˜²è¡›é§æ‰€ä¹‹åœŸåœ°ã€å ´æ‰€ ã€å»ºç¯‰ç‰©å—è¥²æ“¾æˆ–æ“…é—–ï¼Œç¶“è­¦å‘Šä»ä¸è½å¾ï¼Œéä½¿ç”¨æ­¦å™¨è€Œä¸èƒ½åˆ¶æ­¢æ™‚ã€‚", h: "å£è¨£ï¼š<span class='highlight'>å¼·é—–ç‡Ÿå€</span>ï¼è­¦å‘Šä¸è½å°±é–‹æ§ã€‚" },
            { type: "timing", cat: "ç”¨æ§æ™‚æ©Ÿ", id: 5, q: "è¦çŠ¯é€ƒè„«æ™‚...", a: "è¦çŠ¯é€ƒè„«ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½åˆ¶æ­¢æ™‚ã€‚", h: "å£è¨£ï¼š<span class='highlight'>çŠ¯äººè·‘äº†</span>ï¼è§£é–‹æ‰‹éŠ¬è·‘äº†ã€‚" },

            // ç”¨æ§è¦é ˜ (type: guide)
            { type: "guide", cat: "ç”¨æ§è¦é ˜", id: 1, q: "å¦‚éæƒ…å‹¢ç•°å¸¸æ€¥è¿«...", a: "å¦‚éæƒ…å‹¢ç•°å¸¸æ€¥è¿«ï¼Œæ‡‰å…ˆå£é ­è­¦å‘Šä¸¦å°ç©ºé³´æ§è­¦å‘Šä¹‹ã€‚", h: "ç‰›ä»” SOPï¼šå…ˆå¤§å–Š Freeze (å£é ­)ï¼Œå†æœå¤©ç©ºé–‹æ§ (é³´æ§)ã€‚" },
            { type: "guide", cat: "ç”¨æ§è¦é ˜", id: 2, q: "ç¶“è­¦å‘Šå·²æœ‰ç•æœ...", a: "ç¶“è­¦å‘Šå·²æœ‰ç•æœä¹‹æƒ…æ³æ™‚æ‡‰ç«‹å³åœæ­¢ä½¿ç”¨ã€‚", h: "å£äººè·ªåœ°æ±‚é¥’(ç•æœ)äº†ï¼Œé¦¬ä¸Šæ”¶æ§(åœæ­¢)ã€‚" },
            { type: "guide", cat: "ç”¨æ§è¦é ˜", id: 3, q: "ä½¿ç”¨æ­¦å™¨æ‡‰æ³¨æ„...", a: "ä½¿ç”¨æ­¦å™¨æ‡‰æ³¨æ„ï¼Œå‹¿å‚·åŠä»–äººã€‚", h: "å­å½ˆè¦æœƒè½‰å½ï¼Œé–ƒéè·¯é‚Šè³£èŠ±çš„é˜¿å¬¤(å‹¿å‚·ä»–äºº)ã€‚" },
            { type: "guide", cat: "ç”¨æ§è¦é ˜", id: 4, q: "å¦‚éæƒ…å‹¢ç¢ºæœ‰å¿…è¦...", a: "å¦‚éæƒ…å‹¢ç¢ºæœ‰å¿…è¦æ‡‰å„˜é‡é¿å…å‚·åŠå…¶è‡´å‘½éƒ¨ä½ã€‚", h: "çœŸçš„è¦æ‰“åªæ‰“<span class='highlight'>å°è…¿</span>ï¼Œä¸è¦çˆ†é ­(è‡´å‘½éƒ¨ä½)ã€‚" },
            { type: "guide", cat: "ç”¨æ§è¦é ˜", id: 5, q: "ä½¿ç”¨æ­¦å™¨å¾Œ...", a: "ä½¿ç”¨æ­¦å™¨å¾Œï¼Œæ‡‰å°‡ç¶“éæƒ…å½¢å³æ™‚å ±å‘Šè©²ç®¡é•·å®˜ã€‚", h: "æ‰“å®Œæ”¶å·¥ï¼Œæ‹¿ç„¡ç·šé›»è·Ÿé•·å®˜<span class='highlight'>å ±å‘Š</span>ã€‚" }
        ];

        // å…¨åŸŸè®Šæ•¸
        let currentExamList = [];
        let currIdx = 0;
        let score = 0;
        let userInputs = {};
        let isReviewed = {};
        let currentMode = ''; // ç´€éŒ„ç•¶å‰æ¨¡å¼ä»¥ä¾¿é‡ä¾† (sentry, all, etc)

        // UI åˆ‡æ›é‚è¼¯
        function showView(viewId) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active-view'));
            document.getElementById(viewId).classList.add('active-view');
        }

        // 1. é¡¯ç¤ºä¸»é¸å–®
        function showMenu() {
            showView('menu-interface');
        }

        // 2. é–‹å§‹æ¸¬é©— (å…¥å£)
        function startQuiz(mode) {
            currentMode = mode;
            let pool = [];

            if (mode === 'all') {
                pool = [...database];
                pool.sort(() => Math.random() - 0.5);
                currentExamList = pool.slice(0, 10); // éš¨æ©Ÿ 10 é¡Œ
            } else {
                // ç¯©é¸ç‰¹å®šå–®å…ƒ
                pool = database.filter(item => item.type === mode);
                // å–®å…ƒæ¸¬é©—ä¸ä¸€å®šè¦éš¨æ©Ÿï¼Œä¾åºæ¯”è¼ƒå¥½èƒŒï¼Œæˆ–æ˜¯éš¨æ©Ÿä¹Ÿå¯ã€‚é€™è£¡è¨­ç‚ºä¾åºã€‚
                // å¦‚æœæƒ³éš¨æ©Ÿï¼Œè§£é–‹ä¸‹é¢è¨»è§£
                // pool.sort(() => Math.random() - 0.5);
                currentExamList = pool;
            }

            // åˆå§‹åŒ–ç‹€æ…‹
            currIdx = 0;
            score = 0;
            userInputs = {};
            isReviewed = {};

            showView('quiz-interface');
            renderQuestion();
        }

        // 3. é‡æ–°é–‹å§‹ç•¶å‰æ¸¬é©—
        function restartCurrentQuiz() {
            startQuiz(currentMode);
        }

        // 4. ä¸­é€”é€€å‡ºç¢ºèª
        function confirmExit() {
            if (confirm("ç¢ºå®šè¦ä¸­æ–·æ¸¬é©—å›åˆ°ä¸»é¸å–®å—ï¼Ÿ\n(ç›®å‰çš„é€²åº¦å°‡æœƒæ¶ˆå¤±)")) {
                showMenu();
            }
        }

        // æ¸²æŸ“é¡Œç›® (åŒ v1.0 é‚è¼¯)
        function renderQuestion() {
            const q = currentExamList[currIdx];
            
            // UI æ›´æ–°
            document.getElementById('progress-disp').innerText = `${currIdx + 1} / ${currentExamList.length}`;
            document.getElementById('score-disp').innerText = `å¾—åˆ†: ${score}`;
            document.getElementById('q-category').innerText = q.cat;
            
            let qTextDisplay = q.q;
            if(q.cat.includes("ç”¨æ§")) {
                qTextDisplay += " (è«‹æ¥çºŒ)";
            }
            document.getElementById('q-text').innerText = qTextDisplay;

            const input = document.getElementById('user-input');
            input.value = userInputs[currIdx] || "";
            document.getElementById('feedback-ui').style.display = 'none';
            input.className = "";
            input.disabled = false;

            if (isReviewed[currIdx]) {
                showFeedback(true);
            } else {
                const btnAction = document.getElementById('btn-action');
                btnAction.innerHTML = "é€å‡ºæª¢æŸ¥ (Enter)";
                btnAction.className = "btn btn-check";
                btnAction.onclick = submitCheck;
                btnAction.style.display = "flex"; // ç¢ºä¿é¡¯ç¤º
                setTimeout(() => input.focus(), 50);
            }

            document.getElementById('btn-back').disabled = (currIdx === 0);
        }

        function submitCheck() {
            const input = document.getElementById('user-input');
            const val = input.value.trim();
            
            if (!val) {
                input.style.transform = "translateX(5px)";
                setTimeout(() => input.style.transform = "translateX(0)", 100);
                return;
            }

            userInputs[currIdx] = val;
            isReviewed[currIdx] = true;

            const q = currentExamList[currIdx];
            // æ¨¡ç³Šæ¯”å°
            const cleanUser = val.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");
            const cleanAns = q.a.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");
            const isCorrect = (cleanUser === cleanAns);

            // åˆ†æ•¸è¨ˆç®—ï¼šæ¯é¡Œé…åˆ† = 100 / ç¸½é¡Œæ•¸
            // ç‚ºäº†é¡¯ç¤ºæ•´æ•¸ï¼Œç”¨ Math.round
            if (isCorrect) {
                const pointsPerQ = 100 / currentExamList.length;
                score += pointsPerQ;
            }

            // æ›´æ–°åˆ†æ•¸é¡¯ç¤º (å–æ•´æ•¸)
            document.getElementById('score-disp').innerText = `å¾—åˆ†: ${Math.round(score)}`;

            showFeedback(false, isCorrect);
        }

        function showFeedback(isRedraw, passedIsCorrect) {
            const input = document.getElementById('user-input');
            const q = currentExamList[currIdx];
            const val = userInputs[currIdx];
            
            let isCorrect = passedIsCorrect;
            if (isRedraw) {
                const cleanUser = val.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");
                const cleanAns = q.a.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");
                isCorrect = (cleanUser === cleanAns);
            }

            document.getElementById('feedback-ui').style.display = 'block';
            document.getElementById('correct-ans-text').innerText = q.a;
            document.getElementById('hint-text').innerHTML = q.h;

            input.disabled = true;

            if (isCorrect) {
                input.className = "correct-state";
                document.getElementById('user-row').style.display = 'none';
                document.getElementById('comparison-box').style.borderColor = "#27ae60";
                document.getElementById('comparison-box').style.background = "#f0fdf4";
            } else {
                input.className = "wrong-state";
                document.getElementById('user-row').style.display = 'flex';
                document.getElementById('user-ans-text').innerText = val;
                document.getElementById('comparison-box').style.borderColor = "#c0392b";
                document.getElementById('comparison-box').style.background = "#fef2f2";
            }

            const btnAction = document.getElementById('btn-action');
            if (currIdx < currentExamList.length - 1) {
                btnAction.innerHTML = "ä¸‹ä¸€é¡Œ â”";
                btnAction.className = "btn btn-next";
                btnAction.onclick = nextQ;
                btnAction.focus();
            } else {
                btnAction.innerHTML = "æŸ¥çœ‹æˆç¸¾å–® ğŸ“";
                btnAction.className = "btn btn-next";
                btnAction.onclick = showResult;
                btnAction.focus();
            }
        }

        function nextQ() {
            currIdx++;
            renderQuestion();
        }

        function goBack() {
            if (currIdx > 0) {
                currIdx--;
                renderQuestion();
            }
        }

        function showResult() {
            showView('result-interface');
            const finalScore = Math.round(score);
            document.getElementById('final-score-val').innerText = finalScore;
            
            let comment = "";
            if (finalScore === 100) comment = "ğŸ† å®Œç¾ï¼æ¨™é»ç¬¦è™Ÿéƒ½é›£ä¸å€’ä½ ï¼";
            else if (finalScore >= 80) comment = "ğŸ˜ å„ªç§€ï¼æœ‰äº›å°ç´°ç¯€å†æ³¨æ„ä¸€ä¸‹å°±å¥½ã€‚";
            else if (finalScore >= 60) comment = "ğŸ™‚ åŠæ ¼ï¼å£è¨£å¤šå”¸å¹¾æ¬¡æœƒæ›´ç†Ÿã€‚";
            else comment = "ğŸ’€ ä¸åŠæ ¼ï¼ä»Šæ™šç½°å¯«åéï¼";
            
            document.getElementById('final-comment').innerText = comment;
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                // æª¢æŸ¥ç•¶å‰æ˜¯åœ¨å“ªå€‹ç•«é¢ï¼Œå¦‚æœåœ¨ quiz ç•«é¢ä¸”æŒ‰éˆ•å¯æŒ‰
                if (document.getElementById('quiz-interface').classList.contains('active-view')) {
                    const btn = document.getElementById('btn-action');
                    if (btn && !btn.disabled && btn.style.display !== 'none') {
                        btn.click();
                    }
                }
            }
        });

    </script>
</body>
</html>

