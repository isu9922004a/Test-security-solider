<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è»äº‹æº–å‰‡ - åœ–åƒè¨˜æ†¶é‘‘æ¸¬ç³»çµ± (Proç‰ˆ)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f1c40f;
            --light: #ecf0f1;
            --text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: #eef2f3;
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .brand { font-size: 1.2rem; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        
        .timer-badge {
            background: rgba(0,0,0,0.3);
            padding: 5px 12px;
            border-radius: 20px;
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
            display: none;
        }
        .timer-badge.urgent { background-color: var(--accent); animation: pulse 1s infinite; }

        /* Main Container */
        main {
            flex: 1;
            max-width: 800px;
            margin: 20px auto;
            width: 95%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Screens */
        .screen { display: none; animation: fadeIn 0.3s ease; height: 100%; }
        .screen.active { display: block; }

        /* Question UI */
        .progress-container { margin-bottom: 20px; }
        .progress-bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; transition: width 0.3s; }
        .q-counter { text-align: right; font-size: 0.85rem; color: #7f8c8d; margin-top: 5px; }

        .question-card { margin-bottom: 20px; }
        
        .q-header-tag {
            background: var(--light);
            color: var(--secondary);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        /* The Funny Hint Section */
        .brain-theater {
            background-color: #fff9db;
            border-left: 5px solid var(--warning);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
            position: relative;
        }
        
        .brain-theater::before {
            content: "ğŸ¬ è…¦å…§å°åŠ‡å ´";
            font-size: 0.8rem;
            font-weight: bold;
            color: #d35400;
            display: block;
            margin-bottom: 5px;
        }

        .funny-text {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 500;
            line-height: 1.5;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            font-size: 1.15rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: none;
            box-sizing: border-box;
            transition: 0.3s;
            background-color: #fafafa;
        }

        textarea:focus {
            border-color: var(--primary);
            background-color: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(44, 62, 80, 0.1);
        }

        /* Navigation Buttons */
        .nav-controls {
            display: flex;
            justify-content: space-between;
            margin-top: auto; /* Push to bottom if container has height */
            gap: 15px;
        }

        .btn {
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .btn:hover { transform: translateY(-2px); opacity: 0.95; }
        .btn:active { transform: translateY(0); }
        .btn:disabled { background-color: #e0e0e0; color: #a0a0a0; cursor: not-allowed; transform: none; }

        .btn-prev { background-color: #95a5a6; color: white; }
        .btn-next { background-color: var(--primary); color: white; }
        .btn-submit { background-color: var(--success); color: white; }
        .btn-start { width: 100%; font-size: 1.2rem; padding: 15px; background-color: var(--primary); color: white; margin-top: 20px;}

        /* Results */
        .result-card { text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px; margin-bottom: 20px; }
        .score-big { font-size: 3.5rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .review-list { margin-top: 20px; text-align: left; }
        
        .review-item { 
            border-bottom: 1px solid #eee; 
            padding: 15px 0; 
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .diff-box {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 8px;
            font-size: 0.95rem;
        }
        
        .user-ans-box { color: var(--accent); background: #fff5f5; padding: 8px; border-radius: 4px; }
        .correct-ans-box { color: var(--success); background: #f0fdf4; padding: 8px; border-radius: 4px; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        @media (min-width: 600px) {
            .diff-box { grid-template-columns: 1fr 1fr; }
            .nav-controls { gap: 20px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand">ğŸ§  è…¦å…§æˆ°å ´é‘‘æ¸¬ç³»çµ±</div>
        <div class="timer-badge" id="timer">10:00</div>
    </header>

    <main>
        <!-- 1. Start Screen -->
        <div id="screen-start" class="screen active">
            <h2 style="color:var(--primary);">æº–å‚™å¥½äº†å—ï¼Ÿæ•™å®˜ï¼Ÿ</h2>
            <p>æœ¬æ¸¬é©—æ¨¡æ“¬çœŸå¯¦è€ƒè©¦ç’°å¢ƒï¼Œä½†æˆ‘å€‘æœƒçµ¦ä½ ä¸€é»é»ã€Œåœ–åƒæç¤ºã€ä¾†å–šé†’ä½ çš„è¨˜æ†¶ã€‚</p>
            
            <div style="background: #eafaf1; padding: 15px; border-radius: 8px; border-left: 4px solid var(--success);">
                <strong>ğŸ’¡ ç³»çµ±ç‰¹è‰²ï¼š</strong>
                <ul style="margin: 5px 0 0 20px; padding: 0;">
                    <li>å¯ä»¥æŒ‰ <strong>ã€Œä¸Šä¸€é¡Œã€</strong> å›é ­æª¢æŸ¥ã€‚</li>
                    <li>è¼¸å…¥æ¡†æœƒ<strong>è‡ªå‹•ä¿å­˜</strong>ä½ å¯«åˆ°ä¸€åŠçš„ç­”æ¡ˆã€‚</li>
                    <li>è«‹å–„ç”¨<strong>ã€Œè…¦å…§å°åŠ‡å ´ã€</strong>æç¤ºä¾†è¯æƒ³æ¢æ–‡ã€‚</li>
                </ul>
            </div>

            <div style="margin-top: 20px;">
                <label><strong>é¸æ“‡æŒ‘æˆ°ç¯„åœï¼š</strong></label>
                <select id="exam-scope" style="width: 100%; padding: 12px; margin-top: 8px; border-radius: 6px; border: 2px solid #ddd;">
                    <option value="all">ğŸ”¥ å…¨ç¯„åœå¤§äº‚é¬¥ (éš¨æ©Ÿ 10 é¡Œ)</option>
                    <option value="sentry">ğŸ‘® è¡›å“¨å®ˆå‰‡ (8é¡Œ)</option>
                    <option value="safety">ğŸš¨ å®‰å®˜å®ˆå‰‡ (8é¡Œ)</option>
                    <option value="gun">ğŸ”« ç”¨æ§æ™‚æ©Ÿèˆ‡è¦é ˜ (10é¡Œ)</option>
                </select>
            </div>

            <button class="btn btn-start" onclick="startExam()">é–‹å§‹é‘‘æ¸¬</button>
        </div>

        <!-- 2. Exam Screen -->
        <div id="screen-exam" class="screen">
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
                <div class="q-counter" id="q-counter">1 / 10</div>
            </div>

            <div class="question-card">
                <span class="q-header-tag" id="q-tag">é¡åˆ¥</span>
                
                <!-- æç¬‘æç¤ºå€ -->
                <div class="brain-theater">
                    <div class="funny-text" id="funny-hint"></div>
                </div>

                <div style="font-weight: bold; margin-bottom: 8px;">è«‹è¼¸å…¥å®Œæ•´æ¢æ–‡ï¼š</div>
                <textarea id="user-input" placeholder="ä½œç­”å€..." spellcheck="false"></textarea>
            </div>

            <div class="nav-controls">
                <button class="btn btn-prev" id="btn-prev" onclick="prevQuestion()">â¬…ï¸ ä¸Šä¸€é¡Œ</button>
                <button class="btn btn-next" id="btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â¡ï¸</button>
            </div>
        </div>

        <!-- 3. Result Screen -->
        <div id="screen-result" class="screen">
            <h2 style="text-align: center; color: var(--primary);">é‘‘æ¸¬æˆç¸¾å–®</h2>
            
            <div class="result-card">
                <div class="score-big" id="final-score">0</div>
                <div style="color:#7f8c8d; font-weight:bold;">ç¸½åˆ† (æ»¿åˆ† 100)</div>
                <div id="comment" style="margin-top: 10px; font-weight: bold; color: var(--accent);"></div>
            </div>

            <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">è¨‚æ­£èˆ‡æª¢è¨</h3>
            <div id="review-list" class="review-list"></div>

            <button class="btn btn-start" onclick="location.reload()">å†æ¸¬ä¸€æ¬¡ ğŸ”„</button>
        </div>
    </main>

    <script>
        // è³‡æ–™åº«ï¼šåŒ…å«æç¬‘æç¤º (funny)
        const fullDB = [
            // è¡›å“¨
            { cat: "è¡›å“¨å®ˆå‰‡", id: 1, a: "æœè£æ•´é½Šé…ä»¶å…‰äº®", funny: "ğŸª é­”é¡é­”é¡ï¼Œèª°æ˜¯ç‡Ÿå€æœ€çè¶´çš„ç”·äººï¼Ÿä½ çš„è…°å¸¶è¦äº®åˆ°å¯ä»¥ç•¶é¡å­ç…§ï¼" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 2, a: "ç²¾ç¥é£½æ»¿å§¿æ…‹ç«¯æ­£", funny: "ğŸ¦´ ä½ åäº†ä¸€æ ¹é‹¼ç­‹å—ï¼ŸèƒŒæŒºé€™éº¼ç›´ï¼æ˜¯ä¸æ˜¯å·å–äº†åç“¶è »ç‰›ï¼Ÿ" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 3, a: "æ¢°å½ˆæ”œå¸¶ç¢ºéµè¦å®š", funny: "ğŸ’£ è—æ³¢ä¸Šèº«ï¼å­å½ˆæ›æ»¿èº«ï¼Œæ‰‹éŠ¬åœ¨æ§ä¸Šï¼Œå°‘ä¸€é¡†å­å½ˆä½ å°±å®Œè›‹äº†ï¼" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 4, a: "å …å®ˆå´—ä½åš´å¯†æœæŸ¥", funny: "ğŸœ è…³åº•è¢«ä¸‰ç§’è† é»åœ¨åœ°æ¿ä¸Šäº†ï¼æ‹¿è‘—æ”¾å¤§é¡é€£è·¯éçš„èèŸ»éƒ½è¦æœèº«ã€‚" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 5, a: "æé«˜è­¦è¦ºæ™‚æ™‚æˆ’å‚™", funny: "ğŸ“¡ èœ˜è››äººæ„Ÿæ‡‰å…¨é–‹ï¼é ­é ‚è£äº†æ—‹è½‰è­¦ç¤ºç‡ˆï¼Œè€³æœµè®Šæˆé›·é”æ¥æ”¶å™¨ã€‚" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 6, a: "ä¸çœ‹ç†±é¬§æ³¨æ„å¯ç–‘", funny: "ğŸ’ƒ æ—é‚Šæœ‰æ¯”åŸºå°¼è¾£å¦¹åœ¨è·³èˆï¼ˆç†±é¬§ï¼‰ï¼Œä½†æˆ‘æˆ´çœ¼ç½©è£çï¼Œåªç›¯è‘—è§’è½é‚£å€‹ç©¿é»‘é¢¨è¡£çš„æ€ªé˜¿ä¼¯ã€‚" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 7, a: "æœå‹¤èªçœŸèªªè©±å®¢æ°£", funny: "ğŸ’â€â™€ï¸ é›–ç„¶æˆ‘æ˜¯æ®ºæ°£é¨°é¨°çš„è¡›å…µï¼Œä½†æˆ‘å°é˜¿ä¼¯éœ²å‡ºã€Œç©ºæœå“¡ã€èˆ¬çš„ç”œç¾å¾®ç¬‘ã€‚" },
            { cat: "è¡›å“¨å®ˆå‰‡", id: 8, a: "åš´æ ¼ç®¡åˆ¶ä»”ç´°æŸ¥é©—", funny: "ğŸ”¬ æ”¾ä¸‹å·¨å¤§çš„éµæŸµæ¬„ï¼æ‹¿å‡ºã€Œé¡¯å¾®é¡ã€ä¾†æª¢æŸ¥è­‰ä»¶ä¸Šçš„ç´°èŒã€‚" },
            
            // å®‰å®˜
            { cat: "å®‰å®˜å®ˆå‰‡", id: 1, a: "è² è²¬å–®ä½å®‰å…¨", funny: "ğŸ¦ å®‰å®˜æ¡Œä¸Šæ”¾è‘—ä¸€å€‹å·¨å¤§çš„ã€Œä¿éšªç®±ã€ï¼Œæ­»å‘½æŠ±è‘—å®ƒä¸æ”¾ã€‚" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 2, a: "æ¢°å½ˆæ¸…é»ç®¡åˆ¶", funny: "ğŸ’µ æ¡Œä¸Šå…¨æ˜¯æ§è·Ÿå­å½ˆï¼Œåƒåœ¨æ•¸éˆ”ç¥¨ä¸€æ¨£ï¼Œä¸€é¡†éƒ½ä¸èƒ½å°‘ï¼" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 3, a: "åš´å¯†æ°´é›»ç®¡åˆ¶", funny: "âš¡ å·¦æ‰‹æŠ“çš®å¡ä¸˜(é›»)ï¼Œå³æ‰‹æŠ“å‚‘å°¼é¾œ(æ°´)ï¼ŒæŠŠå®ƒå€‘é—œé€²ç± å­è£¡ã€‚" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 4, a: "æ¸…æŸ¥å°±å¯¢äººæ•¸", funny: "ğŸ‘ æ‹¿è‘—ç‰§ç¾Šæ–èµ°é€²å¯¢å®¤ï¼Œä¸€éš»ç¾Šã€å…©éš»ç¾Šã€ä¸‰éš»ç¾Š...ç¡è‘—äº†æ²’ï¼Ÿ" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 5, a: "å·¡è¦–è¡›å“¨å‹¤å‹™", funny: "ğŸ”­ æ‹¿è¶…é•·æœ›é é¡å·çªºé–€å£çš„è¡›å…µï¼Œçœ‹ä»–æœ‰æ²’æœ‰åœ¨å·ç¡è¦ºã€‚" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 6, a: "æ³¨æ„å¯ç–‘äººç‰©", funny: "ğŸ¥· æ¡Œå­åº•ä¸‹çªç„¶é‘½å‡ºä¸€å€‹å¿è€…ï¼æŠ“åˆ°ä½ äº†ï¼" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 7, a: "æ¥è½æˆ°æƒ…é›»è©±", funny: "ğŸ“ ç´…è‰²é›»è©±éŸ¿äº†ï¼è²éŸ³å¤§åˆ°åƒç©ºè¥²è­¦å ±ï¼šã€Œå–‚ï¼é€™è£¡æ˜¯æˆ°æƒ…ä¸­å¿ƒï¼ã€" },
            { cat: "å®‰å®˜å®ˆå‰‡", id: 8, a: "åæ˜ ç·Šæ€¥äº‹æ•…", funny: "ğŸ†˜ å¤±ç«å•¦ï¼ç”¨åŠ›æ‹ä¸‹æ¡Œä¸Šé‚£å€‹å·¨å¤§çš„ç´…è‰² SOS æŒ‰éˆ•ï¼" },

            // ç”¨æ§æ™‚æ©Ÿ
            { cat: "ç”¨æ§æ™‚æ©Ÿ", id: 1, a: "ç”Ÿå‘½èº«é«”å—æš´è¡Œè„…è¿«ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½æŠµæŠ—æˆ–è‡ªè¡›æ™‚", funny: "ğŸ§Ÿâ€â™‚ï¸ æ®­å±ç›´æ¥æä½ä½ çš„è„–å­äº†ï¼ä¸é–‹æ§å°±æœƒè®Šæˆä»–çš„æ™šé¤ï¼ï¼ˆé—œéµå­—ï¼šæŠµæŠ—ã€è‡ªè¡›ï¼‰" },
            { cat: "ç”¨æ§æ™‚æ©Ÿ", id: 2, a: "ç¾¤çœ¾æš´å‹•ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½åˆ¶æ­¢æ™‚", funny: "ğŸ§± ä¸€è¬å€‹æš´æ°‘æ®­å±æ¨å€’åœç‰†è¡éä¾†ï¼é€™å ´é¢ä¸é–‹æ§æ“‹ä¸ä½å•Šï¼ï¼ˆé—œéµå­—ï¼šç¾¤çœ¾æš´å‹•ï¼‰" },
            { cat: "ç”¨æ§æ™‚æ©Ÿ", id: 3, a: "æ‰€è­¦è¡›ä¹‹äººå“¡ç‰©è³‡è»Šèˆ¹èˆªç©ºå™¨å—å±å®³è„…è¿«æ™‚ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½ä¿è­·æ™‚", funny: "âœˆï¸ æ®­å±çˆ¬ä¸Šä½ çš„é£›æ©Ÿã€å¡è»Šè¦æ¶ç‰©è³‡ï¼å¿«ä¿è­·ä½ çš„è³‡ç”¢ï¼ï¼ˆé—œéµå­—ï¼šä¿è­·è»Šèˆ¹èˆªç©ºå™¨ï¼‰" },
            { cat: "ç”¨æ§æ™‚æ©Ÿ", id: 4, a: "å› é˜²è¡›é§æ‰€ä¹‹åœŸåœ°å ´æ‰€å»ºç¯‰ç‰©å—è¥²æ“¾æˆ–æ“…é—–ï¼Œç¶“è­¦å‘Šä»ä¸è½å¾ï¼Œéä½¿ç”¨æ­¦å™¨è€Œä¸èƒ½åˆ¶æ­¢æ™‚", funny: "ğŸš§ æ®­å±ç„¡è¦–è­¦å‘Šï¼Œç¡¬é—–ç‡Ÿå€å¤§é–€ï¼é€™è£¡æ˜¯æˆ‘çš„åœ°ç›¤ï¼ï¼ˆé—œéµå­—ï¼šåœŸåœ°å ´æ‰€ã€æ“…é—–ï¼‰" },
            { cat: "ç”¨æ§æ™‚æ©Ÿ", id: 5, a: "è¦çŠ¯é€ƒè„«ï¼Œéä½¿ç”¨æ­¦å™¨ä¸èƒ½åˆ¶æ­¢æ™‚", funny: "ğŸƒ æŠ“åˆ°çš„æ®­å±ç‹è§£é–‹æ‰‹éŠ¬è·‘äº†ï¼åˆ¥è·‘ï¼ï¼ˆé—œéµå­—ï¼šè¦çŠ¯é€ƒè„«ï¼‰" },

            // ç”¨æ§è¦é ˜
            { cat: "ç”¨æ§è¦é ˜", id: 1, a: "å¦‚éæƒ…å‹¢ç•°å¸¸æ€¥è¿«æ‡‰å…ˆå£é ­è­¦å‘Šä¸¦å°ç©ºé³´æ§è­¦å‘Šä¹‹", funny: "ğŸ¤  è¥¿éƒ¨ç‰›ä»”å°æ±º SOP ç¬¬ä¸€æ­¥ï¼šå…ˆå¤§å–Šã€ŒFreeze!ã€ç„¶å¾Œæœå¤©ç©ºç¢°ä¸€è²ï¼" },
            { cat: "ç”¨æ§è¦é ˜", id: 2, a: "ç¶“è­¦å‘Šå·²æœ‰ç•æœä¹‹æƒ…æ³æ™‚æ‡‰ç«‹å³åœæ­¢ä½¿ç”¨", funny: "ğŸ™‡â€â™‚ï¸ å£äººåš‡åˆ°è·ªåœ°æ±‚é¥’ï¼ˆç•æœï¼‰äº†ï¼Œé¦¬ä¸ŠæŠŠæ§æ”¶èµ·ä¾†ï¼Œåˆ¥èµ°ç«ã€‚" },
            { cat: "ç”¨æ§è¦é ˜", id: 3, a: "ä½¿ç”¨æ­¦å™¨æ‡‰æ³¨æ„å‹¿å‚·åŠä»–äºº", funny: "ğŸ‘µ ä½ çš„å­å½ˆæœƒè½‰å½ï¼å› ç‚ºæ—é‚Šæœ‰å€‹è³£èŠ±çš„ç„¡è¾œé˜¿å¬¤ï¼Œåƒè¬åˆ¥æ‰“åˆ°å¥¹ã€‚" },
            { cat: "ç”¨æ§è¦é ˜", id: 4, a: "å¦‚éæƒ…å‹¢ç¢ºæœ‰å¿…è¦æ‡‰å„˜é‡é¿å…å‚·åŠå…¶è‡´å‘½éƒ¨ä½", funny: "ğŸ¦µ çœŸçš„è¦é–‹æ§ï¼Ÿé‚£å°±æ‰“å°è…¿å°±å¥½ï¼Œæˆ‘å€‘ä¸æƒ³æå‡ºäººå‘½ï¼ˆä¸æ‰“é ­ï¼‰ã€‚" },
            { cat: "ç”¨æ§è¦é ˜", id: 5, a: "ä½¿ç”¨æ­¦å™¨å¾Œæ‡‰å°‡ç¶“éæƒ…å½¢å³æ™‚å ±å‘Šè©²ç®¡é•·å®˜", funny: "ğŸ“» æ§æˆ°çµæŸï¼Œå¸¥æ°£åœ°æ‹¿èµ·ç„¡ç·šé›»ï¼šã€Œå ±å‘Šé•·å®˜ï¼Œå‰›å‰›é–‹äº†ä¸€æ§ï¼Œå®Œç•¢ã€‚ã€" }
        ];

        let currentExam = [];
        let currentIndex = 0;
        let userAnswers = {}; // ä½¿ç”¨ Object å„²å­˜ç­”æ¡ˆï¼Œkey ç‚º index
        let timerInterval;
        let timeLeft = 600; // 10åˆ†é˜

        // æ´—ç‰Œ
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // é–‹å§‹è€ƒè©¦
        function startExam() {
            const scope = document.getElementById('exam-scope').value;
            let pool = [];

            if (scope === 'all') {
                pool = [...fullDB];
                shuffle(pool);
                currentExam = pool.slice(0, 10);
            } else if (scope === 'sentry') {
                currentExam = fullDB.filter(x => x.cat === "è¡›å“¨å®ˆå‰‡");
            } else if (scope === 'safety') {
                currentExam = fullDB.filter(x => x.cat === "å®‰å®˜å®ˆå‰‡");
            } else {
                currentExam = fullDB.filter(x => x.cat.includes("ç”¨æ§"));
            }

            currentIndex = 0;
            userAnswers = {}; // é‡ç½®ç­”æ¡ˆ
            
            document.getElementById('screen-start').classList.remove('active');
            document.getElementById('screen-exam').classList.add('active');
            document.getElementById('timer').style.display = 'block';

            startTimer();
            renderQuestion();
        }

        // æ ¸å¿ƒæ¸²æŸ“å‡½æ•¸
        function renderQuestion() {
            const q = currentExam[currentIndex];
            
            // æ›´æ–° UI æ–‡å­—
            document.getElementById('q-tag').innerText = `${q.cat} - ç¬¬ ${q.id} æ¢/é»`;
            document.getElementById('funny-hint').innerText = q.funny;
            
            // æ›´æ–°é€²åº¦æ¢
            document.getElementById('q-counter').innerText = `${currentIndex + 1} / ${currentExam.length}`;
            const pct = ((currentIndex + 1) / currentExam.length) * 100;
            document.getElementById('progress-fill').style.width = `${pct}%`;

            // æ¢å¾©ä¹‹å‰çš„ä½œç­” (å¦‚æœæœ‰çš„è©±)
            const savedAns = userAnswers[currentIndex] || "";
            document.getElementById('user-input').value = savedAns;
            document.getElementById('user-input').focus();

            // æŒ‰éˆ•ç‹€æ…‹æ§åˆ¶
            const btnPrev = document.getElementById('btn-prev');
            const btnNext = document.getElementById('btn-next');

            btnPrev.disabled = (currentIndex === 0); // ç¬¬ä¸€é¡Œä¸èƒ½æŒ‰ä¸Šä¸€é¡Œ

            if (currentIndex === currentExam.length - 1) {
                btnNext.innerText = "äº¤å·è©•åˆ† ğŸ“";
                btnNext.classList.remove('btn-next');
                btnNext.classList.add('btn-submit');
            } else {
                btnNext.innerText = "ä¸‹ä¸€é¡Œ â¡ï¸";
                btnNext.classList.remove('btn-submit');
                btnNext.classList.add('btn-next');
            }
        }

        // ä¿å­˜ç•¶å‰ç­”æ¡ˆ
        function saveCurrentAnswer() {
            const val = document.getElementById('user-input').value;
            userAnswers[currentIndex] = val;
        }

        // ä¸‹ä¸€é¡Œ
        function nextQuestion() {
            saveCurrentAnswer();
            if (currentIndex < currentExam.length - 1) {
                currentIndex++;
                renderQuestion();
            } else {
                if(confirm("ç¢ºå®šè¦äº¤å·äº†å—ï¼Ÿ")) {
                    finishExam();
                }
            }
        }

        // ä¸Šä¸€é¡Œ
        function prevQuestion() {
            saveCurrentAnswer();
            if (currentIndex > 0) {
                currentIndex--;
                renderQuestion();
            }
        }

        // è¨ˆæ™‚å™¨
        function startTimer() {
            timeLeft = 600;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();

                if (timeLeft <= 60) {
                    document.getElementById('timer').classList.add('urgent');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("æ™‚é–“åˆ°ï¼å¼·åˆ¶äº¤å·ï¼");
                    saveCurrentAnswer(); // æ™‚é–“åˆ°ä¹Ÿè¦å­˜æœ€å¾Œä¸€é¡Œ
                    finishExam();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            document.getElementById('timer').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // çµæŸè©•åˆ†
        function finishExam() {
            clearInterval(timerInterval);
            document.getElementById('screen-exam').classList.remove('active');
            document.getElementById('screen-result').classList.add('active');
            document.getElementById('timer').style.display = 'none';

            let totalScore = 0;
            const reviewContainer = document.getElementById('review-list');
            reviewContainer.innerHTML = '';

            currentExam.forEach((q, idx) => {
                const userAns = userAnswers[idx] || "";
                const score = calculateSimilarity(userAns, q.a);
                totalScore += score;

                // ç”Ÿæˆæª¢è¨å¡ç‰‡
                let badgeColor = score === 100 ? '#27ae60' : (score >= 60 ? '#f39c12' : '#e74c3c');
                let badgeText = score === 100 ? 'å®Œç¾' : (score >= 60 ? 'é€šé' : 'éŒ¯èª¤');

                const html = `
                    <div class="review-item">
                        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                            <strong>${idx+1}. ${q.cat} - ç¬¬${q.id}æ¢</strong>
                            <span style="background:${badgeColor}; color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem;">${badgeText} (${Math.round(score)}%)</span>
                        </div>
                        <div class="diff-box">
                            <div class="user-ans-box">
                                <span style="font-size:0.8rem; color:#999; display:block;">ä½ çš„ç­”æ¡ˆï¼š</span>
                                ${userAns || "(æœªä½œç­”)"}
                            </div>
                            <div class="correct-ans-box">
                                <span style="font-size:0.8rem; color:#999; display:block;">æ­£ç¢ºæ¢æ–‡ï¼š</span>
                                ${q.a}
                            </div>
                        </div>
                    </div>
                `;
                reviewContainer.innerHTML += html;
            });

            const finalAvg = Math.round(totalScore / currentExam.length);
            document.getElementById('final-score').innerText = finalAvg;

            const commentEl = document.getElementById('comment');
            if (finalAvg >= 90) commentEl.innerText = "ğŸ–ï¸ è¨˜æ†¶ä¹‹ç¥ï¼ä½ å¯ä»¥å»æ•™åˆ¥äººäº†ï¼";
            else if (finalAvg >= 80) commentEl.innerText = "ğŸ‘® å„ªç§€ï¼é€™å€‹ç¨‹åº¦ä¸‹éƒ¨éšŠæ²’å•é¡Œï¼";
            else if (finalAvg >= 60) commentEl.innerText = "âš ï¸ å‹‰å¼·åŠæ ¼ï¼Œç´°ç¯€é‚„è¦å†ç£¨ç·´ã€‚";
            else commentEl.innerText = "ğŸ’€ ä¸åŠæ ¼ï¼æ™šä¸Šåˆ¥ç¡äº†ï¼ŒæŠŠå£è¨£å†èƒŒåéï¼";
        }

        // è©•åˆ†æ¼”ç®—æ³• (æ¨¡ç³Šæ¯”å°)
        function calculateSimilarity(s1, s2) {
            const clean1 = s1.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");
            const clean2 = s2.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, "");

            if (!clean1) return 0;
            if (clean1 === clean2) return 100;

            let matchCount = 0;
            let tempUser = clean1;
            for (let char of clean2) {
                const idx = tempUser.indexOf(char);
                if (idx !== -1) {
                    matchCount++;
                    tempUser = tempUser.slice(0, idx) + tempUser.slice(idx + 1);
                }
            }

            const lengthPenalty = Math.max(0, clean1.length - clean2.length) * 0.5;
            let score = (matchCount / clean2.length) * 100 - lengthPenalty;
            return Math.max(0, Math.min(100, score));
        }
    </script>
</body>
</html>

